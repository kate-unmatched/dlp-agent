# DLP-Агент

A lightweight software module that monitors certain user actions in real time, extracts formalized features from them
and transmits them to a central analysis system.

```
dlp_agent/
├── agent.py
├── config.py
├── features/
│   ├── __init__.py
│   ├── file_features.py         # Семантический анализ содержимого
│   └── network_features.py      # Метрики сетевой активности
├── triggers/
│   └── check_triggers.py        # Обнаружение событий
├── utils/
│   └── system.py                # Вспомогательные функции
```

# Структура поведенческих признаков

Этот документ описывает структуру данных, собираемых DLP-агентом для передачи в основной модуль поведенческого анализа и
оценки риска.

---

## 1. Файловая активность

| Название признака               | Тип          | Описание                                                               | Значения датасета |
|---------------------------------|--------------|------------------------------------------------------------------------|-------------------|
| `file_create_count`             | `int`        | Количество созданных файлов за интервал времени                        | норм              | 
| `file_update_count`             | `int`        | Количество изменённых (перезаписанных) файлов за интервал              | норм              |
| `file_delete_count`             | `int`        | Количество удалённых файлов за интервал                                | норм              |
| `file_access_sensitive_docs`    | `int`        | Количество документов, содержащих чувствительные слова                 | норм              |
| `file_sensitive_word_matches`   | `int`        | Общее число вхождений чувствительных слов во всех просмотренных файлах | норм              |
| `file_contains_card_number`     | `binary int` | Признак наличия шаблонов номеров банковских карт в содержимом файлов   | норм              |
| `file_contains_passport_data`   | `binary int` | Признак наличия паспортных или ИНН-данных (по шаблонам)                | норм              |
| `file_confidentiality_score`    | `float`      | Максимальная оценка чувствительности содержимого по ML-модели          | есть заминка      |
| `archive_created_count`         | `int`        | Количество созданных архивов (`.zip`, `.rar`, `.7z`)                   | норм              |
| `file_permission_changed_count` | `int`        | Количество файлов, у которых изменились права доступа на запись        | норм              |
| `file_system_update_count`      | `int`        | Количество изменённых файлов в системных директориях                   | есть заминка      |

---

## 2. Сетевая активность

| Название признака                      | Тип          | Описание                                                                    | Значения датасета         |
|----------------------------------------|--------------|-----------------------------------------------------------------------------|---------------------------|
| `visited_webmail_allowed`              | `int`        | Количество разрешённых посещений почтовых сервисов                          | норм                      |
| `visited_file_sharing_allowed`         | `int`        | Количество разрешённых посещений облачных файловых хранилищ                 | норм                      |
| `http_requests_count`                  | `int`        | Общее количество HTTP/HTTPS-запросов за интервал                            | есть заминка              |
| `upload_volume_MB`                     | `float`      | Объём исходящего трафика в мегабайтах                                       | убрать минусовые значения |
| `distinct_domains_accessed`            | `int`        | Количество уникальных доменных имён, к которым установлено соединение       | норм                      |
| `visited_webmail`                      | `int`        | Количество обращений к почтовым сервисам                                    | норм                      |
| `visited_file_sharing_site`            | `int`        | Количество обращений к сервисам облачного хранения                          | норм                      |
| `vpn_activated`                        | `binary int` | Признак наличия активного процесса VPN-клиента                              | норм                      |
| `proxy_used`                           | `binary int` | Использование прокси (по портам или доменам)                                | норм                      |
| `external_ip_contacted`                | `int`        | Количество уникальных внешних IP-адресов, к которым происходило подключение | норм                      |
| `site_contains_sensitive_words`        | `int`        | Количество доменов, содержащих чувствительные ключевые слова                | норм                      |
| `dns_request_count`                    | `int`        | Количество сгенерированных DNS-запросов (эмулируется по доменам)            | норм                      |
| `suspicious_dns_queries`               | `binary int` | Признак наличия подозрительных DNS-запросов (туннелирование, TOR и т.д.)    | норм                      |
| `non_http_traffic_count`               | `int`        | Количество соединений не по HTTP/HTTPS (например, FTP, SMTP)                | норм                      |
| `used_ftp_or_smtp`                     | `binary int` | Признак использования FTP или SMTP протоколов                               | норм                      |
| `upload_spike_detected`                | `binary int` | Признак резкого скачка исходящего трафика (более 10 МБ за интервал)         | норм                      |
| `visited_risky_category_sites`         | `int`        | Количество сайтов из рискованных категорий (vpn, proxy, darknet и др.)      | норм                      |
| `site_category_diversity`              | `int`        | Количество различных категорий посещённых сайтов                            | норм                      |
| `external_upload_without_web_activity` | `binary int` | Признак передачи данных при почти полном отсутствии веб-активности          | норм                      |
| `site_semantic_risk_score`             | `float`      | Средняя оценка рисков по семантическому анализу сайта (от 0 до 1)           | есть заминка              |

---

## 3. Активность процессов и системных команд

| Название признака             | Тип          | Описание                                                              | Значения датасета |
|-------------------------------|--------------|-----------------------------------------------------------------------|-------------------|
| `process_count`               | `int`        | Общее количество активных процессов в системе                         | норм              |
| `unknown_processes_started`   | `int`        | Количество запущенных программ из списка потенциально опасных         | норм              |
| `admin_tools_used`            | `binary int` | Признак использования административных инструментов                   | норм              |
| `time_in_terminal_sec`        | `int`        | Общее время активности в командных оболочках (в секундах за интервал) | есть заминка      |
| `automation_tool_detected`    | `binary int` | Обнаружено использование средств автоматизации (AutoHotKey и др.)     | норм              |
| `screen_capture_tools_used`   | `binary int` | Признак использования программ захвата экрана                         | норм              |
| `clipboard_sensitive_matches` | `int`        | Количество чувствительных шаблонов, найденных в буфере обмена         | норм              |

---

## 4. Внешние устройства

| Название признака            | Тип          | Описание                                                 | Значения датасета         |
|------------------------------|--------------|----------------------------------------------------------|---------------------------|
| `usb_devices_connected`      | `int`        | Количество обнаруженных USB-устройств                    | норм                      |
| `usb_vendor_blacklisted`     | `binary int` | Признак подключения устройства из чёрного списка         | норм                      |
| `usb_file_copy_count`        | `int`        | Общее количество файлов на USB-носителях                 | норм                      |
| `usb_copy_volume_MB`         | `float`      | Оценочный объём данных на USB-носителях (в мегабайтах)   | убрать минусовые значения |
| `usb_executable_found`       | `binary int` | Обнаружены исполняемые файлы на USB                      | норм                      |
| `usb_encrypted_volume_found` | `binary int` | Найдены признаки шифрования (BitLocker, VeraCrypt и др.) | норм                      |
| `usb_access_outside_hours`   | `binary int` | Доступ к USB-носителям происходил вне рабочего времени   | норм                      |

---

## 5. Временной контекст

| Название признака             | Тип          | Описание                                                 | Значения датасета |
|-------------------------------|--------------|----------------------------------------------------------|-------------------|
| `activity_outside_work_hours` | `binary int` | Признак активности пользователя вне рабочего времени     | норм              |
| `activity_weekend_hours`      | `binary int` | Признак активности в выходные дни (суббота, воскресенье) | норм              |

---

## Формат отправки данных в основной модуль (пример)

```json
{
  "user_id": "user42",
  "timestamp": "2025-05-01T22:00:00",
  "features": {
    "file_create_count": 4,
    "http_requests_count": 37,
    "vpn_activated": 1,
    "...": "..."
  },
  "trigger": "vpn_activated"
}
