# DLP-Агент

A lightweight software module that monitors certain user actions in real time, extracts formalized features from them
and transmits them to a central analysis system.

```
dlp_agent/
├── agent.py
├── config.py
├── features/
│   ├── __init__.py
│   ├── file_features.py         # Семантический анализ содержимого
│   └── network_features.py      # Метрики сетевой активности
├── triggers/
│   └── check_triggers.py        # Обнаружение событий
├── utils/
│   └── system.py                # Вспомогательные функции
```

# Структура поведенческих признаков

Этот документ описывает структуру данных, собираемых DLP-агентом для передачи в основной модуль поведенческого анализа и
оценки риска.

---

## 1. Файловая активность

| Название признака               | Тип     | Описание                                                               |
|---------------------------------|---------|------------------------------------------------------------------------|
| `file_create_count`             | `int`   | Количество созданных файлов за интервал времени                        |
| `file_update_count`             | `int`   | Количество изменённых (перезаписанных) файлов за интервал              |
| `file_delete_count`             | `int`   | Количество удалённых файлов за интервал                                |
| `file_access_sensitive_docs`    | `int`   | Количество документов, содержащих чувствительные слова                 |
| `file_sensitive_word_matches`   | `int`   | Общее число вхождений чувствительных слов во всех просмотренных файлах |
| `file_contains_card_number`     | `int`   | Признак наличия шаблонов номеров банковских карт в содержимом файлов   |
| `file_contains_passport_data`   | `int`   | Признак наличия паспортных или ИНН-данных (по шаблонам)                |
| `file_confidentiality_score`    | `float` | Максимальная оценка чувствительности содержимого по ML-модели          |
| `archive_created_count`         | `int`   | Количество созданных архивов (`.zip`, `.rar`, `.7z`)                   |
| `file_permission_changed_count` | `int`   | Количество файлов, у которых изменились права доступа на запись        |
| `file_system_update_count`      | `int`   | Количество изменённых файлов в системных директориях                   |

---

## 2. Сетевая активность

| Название признака                      | Тип     | Описание                                                                    |
|----------------------------------------|---------|-----------------------------------------------------------------------------|
| `visited_webmail_allowed`              | `int`   | Количество разрешённых посещений почтовых сервисов                          |
| `visited_file_sharing_allowed`         | `int`   | Количество разрешённых посещений облачных файловых хранилищ                 |
| `http_requests_count`                  | `int`   | Общее количество HTTP/HTTPS-запросов за интервал                            |
| `upload_volume_MB`                     | `float` | Объём исходящего трафика в мегабайтах                                       |
| `distinct_domains_accessed`            | `int`   | Количество уникальных доменных имён, к которым установлено соединение       |
| `visited_webmail`                      | `int`   | Количество обращений к почтовым сервисам                                    |
| `visited_file_sharing_site`            | `int`   | Количество обращений к сервисам облачного хранения                          |
| `vpn_activated`                        | `int`   | Признак наличия активного процесса VPN-клиента                              |
| `proxy_used`                           | `int`   | Использование прокси (по портам или доменам)                                |
| `external_ip_contacted`                | `int`   | Количество уникальных внешних IP-адресов, к которым происходило подключение |
| `site_contains_sensitive_words`        | `int`   | Количество доменов, содержащих чувствительные ключевые слова                |
| `dns_request_count`                    | `int`   | Количество сгенерированных DNS-запросов (эмулируется по доменам)            |
| `suspicious_dns_queries`               | `int`   | Признак наличия подозрительных DNS-запросов (туннелирование, TOR и т.д.)    |
| `non_http_traffic_count`               | `int`   | Количество соединений не по HTTP/HTTPS (например, FTP, SMTP)                |
| `used_ftp_or_smtp`                     | `int`   | Признак использования FTP или SMTP протоколов                               |
| `upload_spike_detected`                | `int`   | Признак резкого скачка исходящего трафика (более 10 МБ за интервал)         |
| `visited_risky_category_sites`         | `int`   | Количество сайтов из рискованных категорий (vpn, proxy, darknet и др.)      |
| `site_category_diversity`              | `int`   | Количество различных категорий посещённых сайтов                            |
| `external_upload_without_web_activity` | `int`   | Признак передачи данных при почти полном отсутствии веб-активности          |
| `site_semantic_risk_score`             | `float` | Средняя оценка рисков по семантическому анализу сайта (от 0 до 1)           |

---

## 3. Активность процессов и системных команд

| Название признака           | Тип   | Описание                                                              |
|-----------------------------|-------|-----------------------------------------------------------------------|
| `process_count`             | `int` | Общее количество активных процессов в системе                         |
| `unknown_processes_started` | `int` | Количество запущенных программ из списка потенциально опасных         |
| `admin_tools_used`          | `int` | Признак использования административных инструментов                   |
| `time_in_terminal_sec`      | `int` | Общее время активности в командных оболочках (в секундах за интервал) |
| `automation_tool_detected`  | `int` | Обнаружено использование средств автоматизации (AutoHotKey и др.)     |
| `screen_capture_tools_used` | `int` | Признак использования программ захвата экрана                         |

---

## 4. Внешние устройства

| Название признака            | Тип     | Описание                                                 |
|------------------------------|---------|----------------------------------------------------------|
| `usb_devices_connected`      | `int`   | Количество обнаруженных USB-устройств                    |
| `usb_vendor_blacklisted`     | `int`   | Признак подключения устройства из чёрного списка         |
| `usb_file_copy_count`        | `int`   | Общее количество файлов на USB-носителях                 |
| `usb_copy_volume_MB`         | `float` | Оценочный объём данных на USB-носителях (в мегабайтах)   |
| `usb_executable_found`       | `int`   | Обнаружены исполняемые файлы на USB                      |
| `usb_encrypted_volume_found` | `int`   | Найдены признаки шифрования (BitLocker, VeraCrypt и др.) |
| `usb_access_outside_hours`   | `int`   | Доступ к USB-носителям происходил вне рабочего времени   |

---

## 5. Временной и поведенческий контекст

| Название признака             | Тип   | Описание                                                      |
|-------------------------------|-------|---------------------------------------------------------------|
| `activity_outside_work_hours` | `int` | Признак активности пользователя вне рабочего времени          |
| `activity_weekend_hours`      | `int` | Признак активности в выходные дни (суббота, воскресенье)      |
| `clipboard_sensitive_matches` | `int` | Количество чувствительных шаблонов, найденных в буфере обмена |

---

## Формат отправки данных в основной модуль (пример)

```json
{
  "user_id": "user42",
  "timestamp": "2025-05-01T22:00:00",
  "features": {
    "file_create_count": 4,
    "http_requests_count": 37,
    "vpn_activated": 1,
    "...": "..."
  },
  "trigger": "vpn_activated"
}
